<h2>{{ text_credit_card }}</h2>
<div class="content" id="payment">
    <table class="form">
        <tr>
            <td>{{ cc_cardholder_name }}</td>
            <td><input type="text" name="cc_owner" value="" /></td>
        </tr>

        <tr>
            <td>{{ cc_card_type }}</td>
            <td><select name="cc_type">
                    {% for card in cards %} 
                    <option value="{{ card['value'] }}">{{ card['text'] }}</option>
                    {% endfor %} 
                </select></td>
        </tr>
        <tr>
            <td>{{ cc_card_number }}</td>
            <td><input type="text" name="cc_number" value="" /></td>
        </tr>
        <tr>
            <td>{{ cc_card_start_date }}</td>
            <td><select name="cc_start_date_month">
                    {% for month in months %} 
                    <option value="{{ month['value'] }}">{{ month['text'] }}</option>
                    {% endfor %} 
                </select>
                /
                <select name="cc_start_date_year">
                    {% for year in year_valid %} 
                    <option value="{{ year['value'] }}">{{ year['text'] }}</option>
                    {% endfor %} 
                </select>
                {{ cc_card_start_date_help }}</td>
        </tr>
        <tr>
            <td>{{ cc_card_expiry_date }}</td>
            <td><select name="cc_expire_date_month">
                    {% for month in months %} 
                    <option value="{{ month['value'] }}">{{ month['text'] }}</option>
                    {% endfor %} 
                </select>
                /
                <select name="cc_expire_date_year">
                    {% for year in year_expire %} 
                    <option value="{{ year['value'] }}">{{ year['text'] }}</option>
                    {% endfor %} 
                </select></td>
        </tr>
        <tr>
            <td>{{ cc_card_cvv }}</td>
            <td><input type="text" name="cc_cvv2" value="" size="3" /></td>
        </tr>
        <tr>
            <td>{{ cc_card_issue }}</td>
            <td><input type="text" name="cc_issue" value="" size="1" />
                {{ cc_card_issue_help }}</td>
        </tr>
    </table>
</div>
<div class="buttons">
    <div class="right">
        <input type="button" value="{{ button_confirm }}" id="button-confirm" id="button-confirm" class="btn btn-primary" />
    </div>
</div>
<script type="text/javascript"><!--
    $('#button-confirm').bind('click', function() {
        $.ajax({
            url: 'index.php?route=payment/sagepay_direct/send',
            type: 'post',
            data: $('#payment :input'),
            dataType: 'json',
            beforeSend: function() {
                $('#button-confirm').attr('disabled', true);
                $('#payment').before('<div class="attention"><img src="catalog/view/theme/default/image/loading.gif" alt="" /> {{ text_wait }}</div>');
            },
            complete: function() {
                $('#button-confirm').attr('disabled', false);
                $('.attention').remove();
            },
            success: function(json) {
                if (json['ACSURL']) {
                    $('#3dauth').remove();

                    html  = '<form action="' + json['ACSURL'] + '" method="post" id="3dauth">';
                    html += '<input type="hidden" name="MD" value="' + json['MD'] + '" />';
                    html += '<input type="hidden" name="PaReq" value="' + json['PaReq'] + '" />';
                    html += '<input type="hidden" name="TermUrl" value="' + json['TermUrl'] + '" />';
                    html += '</form>';

                    $('#payment').after(html);

                    $('#3dauth').submit();
                }

                if (json['error']) {
                    alert(json['error']);
                }

                if (json['success']) {
                    location = json['success'];
                }
            }
        });
    });
    //--></script>
